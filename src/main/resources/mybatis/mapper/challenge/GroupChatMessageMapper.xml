<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.ca.gymbackend.challenge.mapper.GroupChatMessageMapper">

    <!-- 새로운 그룹 채팅 메시지를 데이터베이스에 삽입 -->
    <insert id="insertMessage" parameterType="com.ca.gymbackend.challenge.dto.groupchat.GroupChatMessage" useGeneratedKeys="true" keyProperty="groupChatMessageId">
        INSERT INTO group_chat_message (
            challenge_id,
            sender_user_id,
            group_chat_message_content,
            created_at
        ) VALUES (
            #{challengeId},
            #{senderUserId},
            #{groupChatMessageContent},
            #{createdAt}
        )
    </insert>

    <!-- 특정 챌린지의 모든 메시지 기록을 조회 -->
    <select id="findAllMessagesByChallengeId" resultType="com.ca.gymbackend.challenge.dto.groupchat.GroupChatMessage">
        SELECT
            group_chat_message_id AS groupChatMessageId,
            challenge_id AS challengeId,
            sender_user_id AS senderUserId,
            group_chat_message_content AS groupChatMessageContent,
            created_at AS createdAt
        FROM group_chat_message
        WHERE challenge_id = #{challengeId}
        ORDER BY created_at ASC
    </select>

</mapper>